#####################################
Обновление, даунгрейд и удаление
#####################################

.. contents::
	:local:
	:depth: 2

********************
Обновления прошивки
********************

Процесс обновления прошивки использует стандартный механизм установки/обновления пакетов программного обеспечения в любой системе на базе OpenWrt.
Выполните следующие действия, чтобы произвести обновление прошивки.

Обновление через веб-интерфейс
==============================

Прошивка периодически проверяет наличие новой версии и автоматически обновляет систему. В случае, если функция автообновления отключена, синяя кнопка **Upgrade** появляется с правой стороны верхней панели. Нажмите кнопку и подтвердите, чтобы начать обновление.

Кроме того, вы можете обновить информацию о хранилище вручную, нажав кнопку *Update lists* в меню System > Software menu. Если кнопка отсутствует, попробуйте обновить страницу. Чтобы запустить процесс обновления, введите ``firmware`` в поле *Download and install package* и нажмите *OK*.

Обновление через SSH
===============

После подключения к майнеру через SSH обновление до последней версии можно запустить с помощью следующих команд:

::

   # загрузитt последние пакеты с сервера 
opkg update
   # попробуйте обновить прошивку до последней версии
opkg install firmware

Поскольку при установке прошивки происходит перезагрузка, ожидается следующий вывод:

::

   ...
   Collected errors:
   * opkg_conf_load: Could not lock /var/lock/opkg.lock: Resource temporarily unavailable.
   Saving config files...
   Connection to 10.10.10.1 closed by remote host.
   Connection to 10.10.10.1 closed.

***********************************
Сброс до начальной версии Braiins OS
***********************************

Текущий пакет прошивки может быть даунгрейдован до версии, которая была изначально установлена при замене стоковой прошивки. Это можно сделать с помощью

-  *кнопки IP SET* - жмите на нее *10сек* пока красный светодиод не начнет мигать
-  *SD карты* - измените *uEnv.txt* файл так, чтобы он содержал строку **factory_reset=yes**
-  *miner utility* - вызовите ``miner factory_reset`` в командной строке майнера (во то время как SSH подключен)
-  *opkg package* - вызовите ``opkg remove firmware`` в командной строке майнера (во то время как SSH подключен)

***************************
Перепрошивка заводской прошивки
***************************

Использование ранее созданной резервной копии
===============================

По умолчанию резервная копия исходной прошивки создается во время миграции на Braiins OS + и может быть восстановлена с помощью следующих команд:

::
	
	cd FOLDER_PATH/braiins-os_plus
	source .env/bin/activate
	python3 restore2factory.py backup/backup-id-date/ your-miner-hostname-or-ip

Использование заводского образа прошивки
=============================

На Antminer S9 вы можете альтернативно прошить заводской образ прошивки с сайта производителя, где ``FACTORY_IMAGE`` это путь к файлу или URL к ``tar.gz`` (не извлеченный!) файл. Поддерживаемые изображения с соответствующими хэшами MD5 перечислены в `platform.py <https://github.com/braiins/braiins-os/blob/master/upgrade/am1/platform.py>`__
file.

Запустите:

::

	cd FOLDER_PATH/braiins-os_plus
	source .env/bin/activate
	python3 restore2factory.py --factory-image FACTORY_IMAGE your-miner-hostname-or-ip

