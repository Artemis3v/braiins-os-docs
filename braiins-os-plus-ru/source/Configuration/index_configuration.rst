############
Конфигурация
############

.. contents::
  :local:
  :depth: 2

************************************************
Конфигурация Braiins OS+ с помощью BOS+ Toolbox
************************************************

Вы можете легко настроить Braiins OS+ на нескольких устройствах, используя **BOS+ Toolbox**. Для этого следуйте инструкциям в разделе :ref:`bosbox_configure`.

**************************************************************
Конфигурация Braiins OS+ с помощью Дистанционного пакета (SSH)
**************************************************************

Сценарий установки использует два типа аргументов:

   * позиционные аргументы - требуются для завершения установки;
   * опциональные аргументы - необязательные (т.е. не требуются) для завершения установки.

Синтаксис для установочного скрипта следующий:

  ::

    usage: upgrade2bos.py [-h] [--no-backup] [--no-nand-backup]
                      [--no-keep-network] [--keep-hostname] [--no-wait]
                      hostname

**Позиционные аргументы:**

.. code-block:: none

    hostname [hostname ...] Имя хоста или IP-адрес выбранного майнера

**Опциональные аргументы:**

.. code-block:: none

  -h, --help            показать это справочное сообщение и выйти
  --no-backup           пропустить резервное копирование майнера перед обновлением
  --no-nand-backup      пропустить полное резервное копирование NAND (конфигурация все еще копируется)
  
  --no-keep-network     не сохранять конфигурацию сети майнера (использование DHCP)
  --keep-hostname       сохранить имя хоста майнера
  --no-wait             не ждать, пока система полностью обновится

**************
Настройки пула
**************

Пользователи могут указать несколько пулов. Все пулы в одной группе используют стратегию переключения при ошибки пула, что означает, что BOSminer автоматически переключится на второй пул, если первый пул "умрет".

Конфигурация доступна через веб-интерфейс (*Miner -> Configuration*) или в файле конфигурации ``/etc/bosminer.toml``.
 
Синтаксис следующий:

  ::

     [[group]]
     name = 'Default'
     quota = 1

     [[group.pool]]
     enabled = true
     url = 'stratum2+tcp://v2.stratum.slushpool.com/u95GEReVMjK6k5YqiSFNqqTnKU4ypU2Wm8awa6tmbmDmk1bWt'
     user = 'username.workername'
     password = 'secret'

  * *name* - Имя группы пула (объяснено в разделе *Группы пулов* ниже)
  * *quota* - Пользователь установил квоту для группы (объяснено в разделе *Pool Groups* ниже)
  * *enabled* - Начальное состояние пула после инициализации BOSminer (default=true)
  * *url* - Обязательный аргумент для URL сервера, указанного в формате
    ``scheme://HOSTNAME:PORT/POOL_PUBLIC_KEY``. Вам не нужно указывать конкретный порт 
    для * Stratum V2 * в Slush Pool. Причина в том, что протокол все еще 
    находится в разработке, и мы чередуем два порта по умолчанию (**3336** и **3337**) 
    при обновлении протокола. Майнеры, которые не обновляются, могут использовать 
    предыдущую версию протокола. Майнерам, которые делают обновление, не придется беспокоиться 
    об обновлении своего майнинг-URL с новым портом. Есть *новый* обязательный элемент URL-адреса, 
    который представляет собой открытый ключ, объявленный пулом. Этот элемент использует 
    программное обеспечение для майнинга для проверки подлинности конечной точки майнинга, 
    к которой оно подключается. Это предотвращает атаки типа «человек посередине», 
    которые пытаются украсть хэшрейт. Любая такая попытка приводит к неудачной проверке, 
    и программное обеспечение отказывается использовать данную запись пула.
  * *user* - Обязательный аргумент для имени пользователя в формате ``USERNAME.WORKERNAME``
  * *password* - Опциональные настройки пароля

Группы пулов
============

  Пользователи могут создавать несколько разных групп пулов. Все пулы в пределах одной группы используют вышеописанную стратегию  
  восстановления при сбое. При создании нескольких групп пулов работа распределяется по каждой группе с помощью стратегии распределения 
  нагрузки либо на основе квот, либо с фиксированным коэффициентом распределения.

  Пример:

  Группа 1 имеет два указанных пула и ей назначена квота "1". В группе 2 указаны два пула, и ей назначена квота "1".
  
  - Если первый пул в группе 1 умрет, BOSminer переключится на второй пул в группе 1.
  - Работа назначается группам с соотношением 1: 2. - Группа 2 получит вдвое больше работы, назначенной Группе 1.

  Вместо квоты можно использовать фиксированный коэффициент распределения, что разделит работу на основании определенного процентного 
  соотношения. Квота 1:1 эквивалентна фиксированному коэффициенту распределения 0,5 (50%) - оба эти параметра разделят работу пополам и 
  отправят ее двум группам.

  Конфигурация доступна через веб-интерфейс (*Miner -> Configuration*) или в файле конфигурации ``/etc/bosminer.toml``.

  Пример с двумя группами и несколькими пулами:

  ::

     [[group]]
     name = 'MyGroup1'
     quota = 1

     [[group.pool]]
     enabled = true
     url = 'stratum2+tcp://v2.stratum.slushpool.com/u95GEReVMjK6k5YqiSFNqqTnKU4ypU2Wm8awa6tmbmDmk1bWt'
     user = 'userA.worker'

     [[group.pool]]
     enabled = true
     url = 'stratum+tcp://stratum.slushpool.com:3333'
     user = 'userA.worker'

     [[group]]
     name = 'MyGroup2'
     quota = 2

     [[group.pool]]
     url = 'stratum+tcp://stratum.slushpool.com:3333'
     user = 'userB.worker'

  При такой настройке работа будет разделена между двумя группами в соотношении 1:2. По умолчанию майнер будет майнить на первом пуле из 
  группы «MyGroup1» и на единственном пуле, указанным в группе «MyGroup2». Если первый пул в «MyGroup1» "умрет", майнер переключится на 
  второй пул из группы «MyGroup1». Поскольку второй URL-адрес пула не указан для «MyGroup2», ничего не будет предпринято, если на пуле в 
  «MyGroup2» выскочит ошибка.

**********************************
Настройки хэш-цепочек (Hash Chain) 
**********************************

Речь идет о необязательной конфигурации для переопределения настроек по умолчанию для всех хэш-цепочек. Это позволяет пользователям контролировать частоту и напряжение каждой хэш-цепочки и позволяет им включать и выключать AsicBoost.
Пока автонастройка включена, эти настройки игнорируются. Глобальные настройки хэш-цепочек также могут быть переопределены настройками для каждой цепочки.
Конфигурация доступна через веб-интерфейс (*Miner -> Configuration*) или в файле конфигурации ``/etc/bosminer.toml``.
 
Синтаксис следующий:

  ::

     [hash_chain_global]
     asic_boost = true
     frequency = 650.0
     voltage = 8.8

* *asic_boost* - Включить или отключить поддержку AsicBoost (default=true)
* *frequency* - Установить частоту чипа по умолчанию в MHz для всех цепочек хеширования (default=650.0)
* *voltage* - Установить напряжение по умолчанию в V для всех цепочек хеширования (default=8.8)

Синтаксис настроек для каждой цепочки следующий:

  ::

     [hash_chain.6]
     frequency = 650.0
     voltage = 8.8

* *[hash_chain.6]* - Переопределить глобальные настройки для цепочки хэшей '6'
* *frequency* - Переопределить глобальную частоту чипа в MHz для цепочки хэшей '6' (default='hash_chain_global.frequency')
* **(Только Antminer S9)** *voltage* - Отменить глобальное напряжение в V для хэш-цепи '6' (default='hash_chain_global.voltage')

***********************************
Контроль температуры и вентиляторов
***********************************

Режим контроля температуры
==========================

Braiins OS+ поддерживает автоматический контроль температуры (используя `PID controller <https://en.wikipedia.org/wiki/PID_controll>`__).
Контроллер может работать в одном из трех режимов:

-  **Automatic** - Программное обеспечение майнера пытается регулировать скорость вращения вентилятора так, чтобы температура майнера была приблизительно равна целевой температуре (которую можно настроить). Допустимый диапазон температур составляет 0-200 градусов по Цельсию.
-  **Manual** - Вентиляторы поддерживаются на фиксированной, определенной пользователем скорости, независимо от температуры. Это полезно, если у вас есть собственный способ охлаждения майнера или если датчики температуры не работают. Допустимая скорость вращения вентилятора составляет 0% -100%. Блок управления контролирует только горячие и опасные температуры.
-  **Disabled** - **WARNING**: это может повредить устройство, потому что контроль не выполняется!

Режим контроля температуры можно изменить на *Miner -> Configuration* странице или в в файле конфигурации ``/etc/bosminer.toml``.

**Предупреждение**: неправильная настройка вентиляторов (либо путем их выключения, либо при установке слишком низкого уровня вращения, либо при установке слишком высокой целевой температуры) может необратимо **ПОВРЕДИТЬ** ваш майнер.

Температурные пределы по умолчанию
==================================

Температурные пределы по умолчанию установлены для предотвращения перегрева и повреждения майнера.
**Target temperature** это температура, которую старается поддерживать майнер (*по умолчанию* **89°C**).
**Hot temperature** порог, при котором вентиляторы начинают работать на 100% (*по умолчанию* **100°C**).
**Dangerous temperature** порог, при котором BOSminer отключается, чтобы предотвратить перегрев и повреждение майнера (*по умолчанию* **110°C**).

Температурные пределы по умолчанию можно отрегулировать на *Miner -> Configuration* странице или в файле конфигурации ``/etc/bosminer.toml``.

Конфигурация контроля температуры и вентиляторов в ``bosminer.toml``
====================================================================

Значения по умолчанию можно изменить, отредактировав соответствующие строки в файле конфигурации, расположенном в ``/etc/bosminer.toml``.

Синтаксис следующий:

  ::

     [temp_control]
     mode = 'auto'
     target_temp = 85
     hot_temp = 95
     dangerous_temp = 105

* *mode* - Установка режима контроля температуры (default='auto')
* *target_temp* - Установка целевой температуры в градусах Цельсия (default=89.0). Эта опция используется ТОЛЬКО когда 'temp_control.mode' установлен на 'auto'!
* *hot_temp* - Установка температуры в градусах Цельсия (default=100.0). Когда майнер достигнет этой температуры, скорость вентилятора установится на 100%.
* *dangerous_temp* - Установка опасных температурных пределов в градусах Цельсия (default=110.0). Когда майнер достигнет этой температуры, майнинг отключится! **ПРЕДУПРЕЖДЕНИЕ:** слишком высокое значение этого параметра может повредить устройство!


  ::

     [fan_control]
     speed = 100
     min_fans = 1

* *speed* - Установка фиксированной скорости вентилятора в % (default=70). Эта опция НЕ используется, когда *temp_control.mode* установлен на 'auto'!
* *min_fans* - Установка минимального количества вентиляторов, необходимых для запуска BOSminer (default=1).
* Чтобы полностью **отключить управление вентилятором**, установите 'speed' и 'min_fans' на 0.
  
Работа вентилятора
==================

1. Как только датчики температуры инициализированы, управление вентилятором включается. Если температурные датчики не работают или они считывают температуру 0, вентиляторы автоматически устанавливаются на полную скорость.
2. Если текущим режимом является “fixed fan speed”, вентилятор устанавливается на заданную скорость.
3. Если текущим режимом является “automatic fan control”, скорость вентилятора регулируется температурой.
4. В случае, если температура майнера выше * HOT temperature*, вентиляторы устанавливаются на 100% (даже в режиме “fixed fan speed”).
5. В случае, если температура майнера выше *DANGEROUS temperature*, BOSminer
   Выключается (даже в режиме “fixed fan speed”).

*****************
Настройки тюнинга
*****************

Тюнинг может быть настроен либо через web GUI, с помощью BOS+ Toolbox, либо в файле конфигурации ``/etc/bosminer.toml``.

Чтобы изменить конфигурацию через web GUI, зайдите в *Miner -> Configuration* меню и редактируйте *Autotuning* секцию.

Чтобы изменить конфигурацию на нескольких устройствах с помощью **BOS+ Toolbox**, выполните действия, описанные в разделе :ref:`bosbox_configure`.

Чтобы внести изменения в файл конфигурации, подключитесь к майнеру через SSH и отредактируйте файл ``/etc/bosminer.toml``. 
Синтаксис следующий:

  ::

     [autotuning]
     enabled = true
     psu_power_limit = 1200

Строка *enabled* может содержать значения *true* для включения автонастройки или *false* для ее отключения.
Строка *psu_power_limit* может содержать цифирные значения (min. 100 and max. 5000), представляющий предел мощности блока питания (в Watt) для трех хэшбордов и платы управления.

Кроме того, можно автоматически включить автонастройку после завершения установки, указав ``--power-limit POWER_LIMIT`` аргумент в команде установки.

*********************
Dynamic Power Scaling
*********************

Dynamic Power Scaling automatically lowers the power limit of the miner by a user-set amount if the device reaches the *Hot Temperature*. Upon reaching the user-set minimal power limit, the miner shuts down in order to cool down. The miner starts to work on the original power limit again after a user-set period of time.

Dynamic Power Scaling can be configured either via web GUI, using BOS+ Toolbox or in the configuration file ``/etc/bosminer.toml``.

To make a configuration change via web GUI, enter the *Miner -> Configuration* menu and edit
the *Dynamic Power Scaling* section.

To make a configuration change on multiple devices using the **BOS+ Toolbox**, follow the steps in the section :ref:`bosbox_configure`.

To make a configuration change in the configuration file, connect to the miner via SSH and edit
the file ``/etc/bosminer.toml``. The syntax is the following:

  ::

     [power_scaling]
     enabled = false
     power_step = 100
     min_psu_power_limit = 800
     shutdown_enabled = true
     shutdown_duration = 3.0

The *enabled* line can hold values *true* for enabled Dynamic Power Scaling, or *false* for disabled Dynamic Power Scaling.
The *power_step* can hold numeric values (min. 100 and max. 1000), representing the power limit step-down (in Watts), which happens each time miner hits *HOT* temperature.
The *min_psu_power_limit* can hold numeric values (min. 100 and max. 5000), representing the minimal PSU power limit for the Dynamyc Power Scaling. If *psu_power_limit* is at *min_psu_power_limit* level and miner is still *HOT* and *shutdown_enabled* is true, then miner is shut down for a period of time, defined in the *shutdown_duration* value (in hours). After that, miner is started but with the initial value of *psu_power_limit* (*PSU power limit* in the *Autotuning* section).

**************************
Автоматическое обновление
**************************

Когда автоматическое обновление включено, устройство будет периодически проверять наличие новой версии Braiins OS и обновляться до нее автоматически при обнаружении. Эта функция включается по умолчанию после переключения со стандартной прошивки, но ее необходимо включить вручную, если пользователь обновил более старую версию Braiins OS или Braiins OS+.

Автообновление можно настроить либо через веб-интерфейс, либо с помощью BOS+ Toolbox.

Чтобы изменить конфигурацию через веб-интерфейс, войдите в меню *System -> Upgrade* и отредактируйте раздел *System Upgrade*.

Чтобы изменить конфигурацию на нескольких устройствах с помощью **BOS+ Toolbox**, выполните действия, описанные в разделе :ref:`bosbox_configure`.

В качестве альтернативы можно отключить **автоматическое обновление** во время установки, указав аргумент ``--no-auto-upgrade`` в команде установки.

**********
SSH пароль
**********

Вы можете установить пароль майнера через SSH с удаленного хоста, выполнив следующую команду и заменив *[newpassword]* на ваш собственный пароль.

*Примечание: Braiins OS+ *\ **не**\ *хранит историю выполненных команд*

  .. code:: bash

     ssh root@[miner-hostname-or-ip] 'echo -e "[newpassword]\n[newpassword]" | passwd'

Чтобы выполнить для нескольких хостов параллельно, вы можете использовать`p-ssh <https://linux.die.net/man/1/pssh>`__.

***************
MAC & IP адреса
***************

По умолчанию MAC-адрес устройства остается таким же, каким он был во встроенном программного обеспечения (стоковая версия или Braiins OS), хранящимся в устройстве (NAND). Таким образом, после загрузки устройства с Braiins OS+, оно будет иметь тот же IP-адрес, что и при заводской прошивке.

Кроме того, вы можете указать MAC-адрес по вашему выбору, изменив ``ethaddr=`` параметр в файле ``uEnv.txt`` (который можете найти в первом FAT разделе SD-карты).
