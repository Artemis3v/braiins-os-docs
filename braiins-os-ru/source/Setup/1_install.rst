############
Установка
############

.. contents::
	:local:
	:depth: 1

***************
Начинаем
***************

Этот документ представляет собой краткое руководство по установке Braiins OS на ваше майнинг-устройство. Есть два способа как тестировать и использовать Braiins OS:

1. **Загрузка с SD-карты** с образом Braiins OS, что позволяет сохранить стоковую прошивку во встроенной флэш-памяти. В случае возникновения каких-либо проблем вы сможете просто загрузить стоковую прошивку из внутренней памяти. Это безопасный метод, с которого мы предлагаем начинать.

2. **Полностью перепрошить стоковую прошивку**, заменив при этом прошивку производителя безвозвратно на Braiins OS. В этом случае, единственный способ вернуться к стандартным настройкам по умолчанию – это восстановить прошивку производителя из резервной копии, созданной во время установки, или путем перепрошития заводской прошивки.

По вышеупомянутым причинам настоятельно рекомендуется устанавливать прошивку Braiins OS **только на устройства со слотами для SD карт**.

Чтобы начать майнинг с использованием Braiins OS и BOSminer, необходимо:

  * иметь поддерживаемый ASIC-майнер 
  * загрузить последнюю версию Braiins OS
  * установить Braiins OS
  * настроить Braiins OS и начать майнинг

*Примечание: Команды, используемые в данном руководстве, предназначены для ознакомительных целей. Возможно, вам придется соответствующим образом настроить пути и имена файлов.*

**************************
Руководство по установке / Обновлению
**************************

Для лучшей навигации по различным путям установки / обновления используйте следующее руководство:

 * **Стоковая прошивка -> Braiins OS+ (последняя версия)** - Следуйте инструкциям в разделах :ref:`sd_card_method` или 		:ref:`remote_ssh_method` below
 * **Braiins OS (старшие версии) -> Braiins OS+ (последняя версия)** - Следуйте этому разделу руководства по обновлению :ref:`upgrade_community_bos_plus`
 * **Braiins OS (старшие версии) -> Braiins OS Общественный Релиз (последняя версия)** Следуйте этому разделу руководства по обновлению :ref:`downgrade_bos_plus_community`
 * **Braiins OS Общественный Релиз (последняя версия) -> Braiins OS+ (последняя версия)** Следуйте этому разделу руководства по обновлению :ref:`upgrade_community_bos_plus`
 * **Braiins OS+ (последняя версия) -> Braiins OS Общественный Релиз (последняя версия)** Следуйте этому разделу руководства по обновлению :ref:`downgrade_bos_plus_community`
 * **Braiins OS+ -> Stock** - Follow the this section of the upgrade guide :ref:`downgrade_bos_stock`

.. _sd_card_method:

**************
Метод SD-карты
**************

* Загрузите последнюю версию с нашего `веб-сайта <https://braiins-os.com/>`_.
Вы можете проверить подписи с помощью открытого ключа, который `доступен здесь. <https://slushpool.com/media/download/braiins-os.gpg.pub>`_
* Перенесите загруженный образ на SD-карту (например, используя `Etcher <https://etcher.io/>`_).
* Настройте перемычки для загрузки с SD-карты (вместо памяти NAND), как показано ниже.

	.. |pic1| image:: ../_static/s9-jumpers.png
	    :width: 45%
	    :alt: S9 Jumpers

	.. |pic2| image:: ../_static/s9-jumpers-board.png
	    :width: 45%
	    :alt: S9 Jumpers Board

	|pic1|  |pic2|

* Вставьте SD-карту в устройство, затем запустите устройство.
* Через некоторое время вы сможете получить доступ к интерфейсу Braiins OS+ через IP-адрес устройства.

**Использование одной SD-карты на нескольких устройствах**

Последний использованный MAC-адрес сохраняется в разделе наложения SD-карты (SD card overlay partition), чтобы проверить, была ли SD-карта вставлена в то же устройство. Если текущий MAC-адрес отличается от предыдущего, тогда конфигурация сети и системы сбрасывается на значение по умолчанию и ``/etc/miner_hwid`` удаляется.

HW_ID определяется из NAND, если в нем хранится прошивка Braiins OS. Если NAND поврежден или содержит стоковую прошивку, то используется файл ``/etc/miner_hwid``, если он существует, в противном случае генерируется новый HW_ID и сохраняется в ``/etc/miner_hwid`` для сохранения HW_ID до следующего загрузки.

Перенос Braiins OS с SD карты во внутреннюю память (NAND)
============================================================

Также можно установить Braiins OS+ во внутреннюю память (NAND) во время работы прошивки с SD-карты.
Чтобы перенести Braiins OS+ на NAND, подключитесь к майнеру через SSH и используйте следующую команду:

::

  miner nand_install

.. _remote_ssh_method:

**********
Метод SSH
**********

Установка Braiins OS с использованием так называемого *Метода SSH* состоит из следующих шагов:

* *(Кастомная прошивка)* Перепрошейте на заводскую прошивку (этот шаг можно пропустить, если устройство работает на заводской прошивке или на предыдущих версиях Braiins OS).
* *(Только Windows)* Установите *Ubuntu для Windows 10* доступный в Microsoft Store `здесь. <https://www.microsoft.com/en-us/store/p/ubuntu/9nblggh4msv6>`_
* Запустите следующие команды в командной строке:

*(Обратите внимание, что команды совместимы с Ubuntu и Ubuntu для Windows 10. Если вы используете другой дистрибутив Linux или другую ОС, пожалуйста, ознакомьтесь с соответствующей документацией и отредактируйте команды при необходимости.)*

::

  # Подготовьте среду и загрузите прошивку (этот шаг можно пропустить, если это уже было сделано ранее)
  sudo apt update && sudo apt install python3 python3-virtualenv virtualenv
  wget -c https://feeds.braiins-os.org/20.03/braiins-os_am1-s9_ssh_2019-02-21-0-572dd48c_2020-03-29-0-6ec1a631.tar.gz -O - | tar -xz && cd ./braiins-os_am1-s9_ssh_2019-02-21-0-572dd48c_2020-03-29-0-6ec1a631
  virtualenv --python=/usr/bin/python3 .env && source .env/bin/activate && python3 -m pip install -r requirements.txt && deactivate
  
  # Установите Braiins OS на устройство
  cd ~/braiins-os_am1-s9_ssh_2019-02-21-0-572dd48c_2020-03-29-0-6ec1a631 && source .env/bin/activate
  python3 upgrade2bos.py IP_ADDRESS

*************************************
Установка / Обновление нескольких устройств
*************************************

В случае, если вам нужно выполнить установку или обновление на нескольких устройствах, вы можете использовать
нашу таблицу конфигурации, которая будет генерировать команды для различных случаев использования.

Таблица доступна `здесь <https://docs.google.com/spreadsheets/d/1H3Zn1zSm6-6atWTzcU0aO63zvFzANgc8mcOFtRaw42E>`_
